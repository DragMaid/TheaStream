<!DOCTYPE html>
<html>
<head>
    <title>Cambodian Theater</title>
</head>
<body>

<h1>Cambodian Theater Performance</h1>

<!-- Video Player -->
<video id="theater-video" width="720" height="400" controls autoplay muted>
    <source src="{{ video_url }}" type="video/mp4">
</video>

<!-- AI Chat Box -->
<div id="ai-chat-box" style="margin-top: 20px;">
    <h2>Ask About the Performance</h2>
    <textarea id="user_message" placeholder="Type your question here..." rows="4" required
        style="width: 70%; padding: 10px; border-radius: 4px; border: 1px solid #555; font-size: 16px;"></textarea>
    <br>
    <button onclick="sendToAI()"
        style="padding: 10px 20px; margin-top: 10px; border-radius: 4px; background-color: #ffcc00; border: none; cursor: pointer;">
        Send
    </button>
</div>

<!-- Response Display -->
<div id="ai-response-box" style="margin-top: 20px;">
    <h3>AI Response</h3>
    <p id="ai-response-text" style="font-style: italic;">Waiting for your question...</p>
</div>

<script>
async function sendToAI() {
    const question = document.getElementById('user_message').value;
    const video = document.getElementById('theater-video');

    // Capture screenshot from video
    const canvas = document.createElement('canvas');
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    const ctx = canvas.getContext('2d');
    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

    const blob = await new Promise(resolve => canvas.toBlob(resolve, 'image/jpeg'));

    // Create form data
    const formData = new FormData();
    formData.append('question', question);
    formData.append('screenshot', blob, 'screenshot.jpg');

    // Display loading
    document.getElementById('ai-response-text').innerText = "Thinking...";

    try {
        const response = await fetch('/ask-ai/', {
            method: 'POST',
            body: formData
        });

        const data = await response.json();
        document.getElementById('ai-response-text').innerText = data.response;
    } catch (error) {
        console.error(error);
        document.getElementById('ai-response-text').innerText = "Something went wrong.";
    }
}
</script>

</body>
</html>
